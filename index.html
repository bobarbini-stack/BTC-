<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>ØµØ±Ø§ÙÛŒ BTC</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#020617;color:white;}
.topbar {position:fixed;top:0;left:0;width:100%;padding:40px 20px 10px 20px;background:#020617;border-bottom:1px solid #1e293b;font-size:18px;font-weight:bold;z-index:999;}
#tomanTop {color:#22c55e;font-size:20px;}
.main {display:flex;justify-content:center;align-items:center;height:100vh;}
.coin-btn {padding:14px 30px;border:none;border-radius:10px;background:#f59e0b;font-size:18px;font-weight:bold;cursor:pointer;}

/* Ù…ÙˆØ¯Ø§Ù„ */
.modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:500;}
.modal-content {width:380px;background:#020617;padding:20px;border-radius:12px;position:relative;text-align:center;}
.close-btn {position:absolute;top:8px;left:10px;cursor:pointer;font-size:18px;}

/* Ø¯Ú©Ù…Ù‡ Ù‡Ø§ */
#spinnerBtn,#codeBtn,#historyBtn,#resetBtn {position:fixed;right:20px;width:50px;height:50px;border-radius:50%;border:none;cursor:pointer;z-index:1000;font-size:12px;color:white;font-weight:bold;}
#spinnerBtn{top:30px;background:#f59e0b;font-size:22px;}
#codeBtn{top:100px;background:#0ea5e9;}
#historyBtn{top:170px;background:#9333ea;}
#resetBtn{top:240px;background:#ef4444;}

#wheelContainer {position:relative;width:300px;height:300px;margin:20px auto;}
#wheelCanvas {background:#020617;border-radius:50%;display:block;}
button.trade {padding:8px 16px;margin:5px;border-radius:6px;font-weight:bold;cursor:pointer;border:none;}
button.buy{background:#22c55e;color:black;}
button.sell{background:#ef4444;color:white;}
</style>
</head>
<body>

<div class="topbar">ğŸ’° <span id="tomanTop">0</span></div>

<div class="main">
  <button class="coin-btn" onclick="openBTC()">ğŸª™ BTC</button>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ BTC -->
<div class="modal" id="btcModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeBTC()">âœ–</div>
    <h2>ğŸ’± BTC</h2>
    <div class="price"><span id="price">0</span> ØªÙˆÙ…Ø§Ù†</div>
    <div class="wallet">Ø¯Ø§Ø±Ø§ÛŒÛŒ: <span id="btc">0</span> BTC</div>
    <input type="number" id="amount" placeholder="Ù…Ù‚Ø¯Ø§Ø± BTC" min="0.01" step="0.01">
    <div style="display:flex;justify-content:space-between;">
      <button class="trade buy" onclick="buy()">Ø®Ø±ÛŒØ¯</button>
      <button class="trade sell" onclick="sell()">ÙØ±ÙˆØ´</button>
    </div>
  </div>
</div>

<!-- Ø¯Ú©Ù…Ù‡ Ù‡Ø§ -->
<button id="spinnerBtn">ğŸ¡</button>
<button id="codeBtn" onclick="openCodeModal()">Ú©Ø¯</button>
<button id="historyBtn" onclick="openHistory()">ğŸ“œ</button>
<button id="resetBtn" onclick="openResetModal()">ğŸ—‘ï¸</button>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ -->
<div class="modal" id="spinnerModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeSpinner()">âœ–</div>
    <h2>ğŸ¡ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</h2>
    <div id="wheelContainer">
      <canvas id="wheelCanvas" width="300" height="300"></canvas>
    </div>
    <button onclick="spinWheel()">Ú†Ø±Ø®Ø´</button>
    <p id="rewardText" style="font-size:24px;color:#22c55e;margin-top:10px;"></p>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ú©Ø¯ Ø¬Ø§ÛŒØ²Ù‡ -->
<div class="modal" id="codeModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeCodeModal()">âœ–</div>
    <h2>ğŸ Ú©Ø¯ Ø¬Ø§ÛŒØ²Ù‡</h2>
    <input type="text" id="rewardCode" placeholder="Ú©Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" style="padding:8px;width:90%;border-radius:6px;border:none;margin-top:10px;">
    <button onclick="checkCode()" style="margin-top:10px;padding:8px 16px;border:none;border-radius:8px;background:#22c55e;font-weight:bold;">ØªØ§ÛŒÛŒØ¯</button>
    <p id="codeMessage" style="margin-top:10px;font-size:20px;"></p>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
<div class="modal" id="historyModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeHistory()">âœ–</div>
    <h2>ğŸ“œ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h2>
    <div id="historyList" style="text-align:right;max-height:200px;overflow:auto;margin-top:10px;"></div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø­Ø°Ù Ø§Ú©Ø§Ù†Øª -->
<div class="modal" id="resetModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeResetModal()">âœ–</div>
    <h2>âš ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ú©Ø§Ù†Øª</h2>
    <p>Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯!</p>
    <button onclick="resetAccount()" style="margin-top:10px;padding:8px 16px;border:none;border-radius:8px;background:#ef4444;color:white;font-weight:bold;">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
  </div>
</div>

<script>
let price=50;
let toman=parseInt(localStorage.getItem("toman"))||0;
let btc=parseFloat(localStorage.getItem("btc"))||0;
let history=JSON.parse(localStorage.getItem("history"))||[];
let usedCodes=JSON.parse(localStorage.getItem("usedCodes"))||{};

// ğŸ’° ÙØ±Ù…Øª Ø³Ù‡ Ø±Ù‚Ù…
function formatMoney(num){return Math.floor(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}
function saveStorage(){ 
  localStorage.setItem("toman",toman); 
  localStorage.setItem("btc",btc);
  localStorage.setItem("history",JSON.stringify(history));
  localStorage.setItem("usedCodes",JSON.stringify(usedCodes));
}
function updateUI(){ 
  document.getElementById("price").innerText=formatMoney(price); 
  document.getElementById("btc").innerText=btc.toFixed(8); 
  document.getElementById("tomanTop").innerText=formatMoney(toman);
}

// Ø®Ø±ÛŒØ¯
function buy(){ 
  let amount=parseFloat(document.getElementById("amount").value);
  if(!amount||amount<=0) return alert("Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª");
  let cost=amount*price;
  if(toman<cost) return alert("Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª");
  toman-=cost; toman=Math.floor(toman);
  btc+=amount; btc=parseFloat(btc.toFixed(8));
  history.unshift("Ø®Ø±ÛŒØ¯ "+amount+" BTC Ø¨Ù‡ Ù‚ÛŒÙ…Øª "+formatMoney(cost)+" ØªÙˆÙ…Ø§Ù†");
  saveStorage(); updateUI(); document.getElementById("amount").value="";
}

// ÙØ±ÙˆØ´
function sell(){
  let amount=parseFloat(document.getElementById("amount").value);
  if(!amount||amount<=0) return alert("Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª");
  if(btc<amount) return alert("BTC Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª");
  btc-=amount; btc=parseFloat(btc.toFixed(8));
  let gain=amount*price; toman+=gain; toman=Math.floor(toman);
  history.unshift("ÙØ±ÙˆØ´ "+amount+" BTC Ø¨Ù‡ Ù‚ÛŒÙ…Øª "+formatMoney(gain)+" ØªÙˆÙ…Ø§Ù†");
  saveStorage(); updateUI(); document.getElementById("amount").value="";
}

// Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§
function openBTC(){document.getElementById("btcModal").style.display="flex";}
function closeBTC(){document.getElementById("btcModal").style.display="none";}

// Ù‚ÛŒÙ…Øª ØªØµØ§Ø¯ÙÛŒ Ø¨Ø¯ÙˆÙ† ØªÚ©Ø±Ø§Ø±
let priceList=[10,20,30,40,50,60,70,80,90,100,150,200];
let lastPrice=parseInt(localStorage.getItem("lastPrice"))||50; price=lastPrice;
setInterval(()=>{
  let newPrice;
  do{newPrice=priceList[Math.floor(Math.random()*priceList.length)];}while(newPrice===lastPrice);
  price=newPrice; lastPrice=newPrice; localStorage.setItem("lastPrice",lastPrice); updateUI();
},100);

// Ú¯Ø±Ø¯ÙˆÙ†Ù‡
const spinnerBtn=document.getElementById("spinnerBtn"); const spinnerModal=document.getElementById("spinnerModal"); const rewardText=document.getElementById("rewardText");
spinnerBtn.addEventListener("click",()=>{rewardText.innerText=""; spinnerModal.style.display="flex";});
function closeSpinner(){spinnerModal.style.display="none";}
spinnerModal.addEventListener("click",e=>{if(e.target===spinnerModal) closeSpinner();});
const canvas=document.getElementById("wheelCanvas"); const ctx=canvas.getContext("2d");
const rewards=[500,200,100,50,10,1]; const colors=["#f87171","#fbbf24","#34d399","#60a5fa","#a78bfa","#f472b6"];
const n=rewards.length; const radius=canvas.width/2; let currentRotation=0; let spinning=false;
function drawWheel(rotation=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<n;i++){
    const start=(i/n)*2*Math.PI+rotation;
    const end=((i+1)/n)*2*Math.PI+rotation;
    const mid=(start+end)/2;
    ctx.beginPath(); ctx.moveTo(radius,radius); ctx.arc(radius,radius,radius,start,end); ctx.closePath(); ctx.fillStyle=colors[i]; ctx.fill();
    ctx.save(); ctx.translate(radius,radius); ctx.rotate(mid); ctx.fillStyle="black"; ctx.font="bold 16px Arial"; ctx.textAlign="center"; ctx.textBaseline="middle";
    ctx.fillText(rewards[i]+" ØªÙˆÙ…Ø§Ù†",radius*0.6,0); ctx.restore();
  }
}
drawWheel();
function spinWheel(){
  if(spinning) return; spinning=true;
  const segmentAngle=2*Math.PI/n;
  const randomIndex=Math.floor(Math.random()*n);
  const randomOffset=Math.random()*segmentAngle;
  const finalRotation=5*2*Math.PI+randomIndex*segmentAngle+randomOffset;
  const duration=4000; const start=performance.now(); const startRotation=currentRotation;
  function animate(time){
    const elapsed=time-start; const t=Math.min(elapsed/duration,1); const ease=1-Math.pow(1-t,3);
    currentRotation=startRotation+(finalRotation-startRotation)*ease;
    drawWheel(currentRotation);
    if(t<1) requestAnimationFrame(animate);
    else{
      let normalizedRotation=(currentRotation+Math.PI/2)%(2*Math.PI);
      if(normalizedRotation<0) normalizedRotation+=2*Math.PI;
      let landedIndex=n-Math.floor(normalizedRotation/segmentAngle); landedIndex%=n;
      const won=rewards[landedIndex];
      rewardText.innerText="ğŸ’° +"+won+" ØªÙˆÙ…Ø§Ù†"; toman+=won; toman=Math.floor(toman); saveStorage(); updateUI(); spinning=false;
    }
  }
  requestAnimationFrame(animate);
}

// ØªØ§Ø±ÛŒØ®Ú†Ù‡
function openHistory(){const list=document.getElementById("historyList");
  if(history.length===0){list.innerHTML="<p>Ù‡ÛŒÚ† Ù…Ø¹Ø§Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡</p>";}else{list.innerHTML=history.map(item=>"<p>â€¢ "+item+"</p>").join("");}
  document.getElementById("historyModal").style.display="flex";
}
function closeHistory(){document.getElementById("historyModal").style.display="none";}

// Ú©Ø¯ Ø¬Ø§ÛŒØ²Ù‡
function openCodeModal(){document.getElementById("codeModal").style.display="flex";}
function closeCodeModal(){document.getElementById("codeModal").style.display="none";}
function checkCode(){
  const code=document.getElementById("rewardCode").value.trim(); const msg=document.getElementById("codeMessage");
  if(usedCodes[code]){msg.innerText="Ú©Ø¯ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡"; msg.style.color="orange"; return;}
  if(code==="Rolweri"){btc+=50; btc=parseFloat(btc.toFixed(8)); usedCodes[code]=true; saveStorage(); updateUI(); msg.innerText="Ø¬Ø§ÛŒØ²Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯"; msg.style.color="#22c55e";}
  else if(code==="TNT100"){toman+=2000; toman=Math.floor(toman); usedCodes[code]=true; saveStorage(); updateUI(); msg.innerText="Ø¬Ø§ÛŒØ²Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯"; msg.style.color="#22c55e";}
  else {msg.innerText="Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª"; msg.style.color="red";}
}

// Ø­Ø°Ù Ø§Ú©Ø§Ù†Øª
function openResetModal(){document.getElementById("resetModal").style.display="flex";}
function closeResetModal(){document.getElementById("resetModal").style.display="none";}
function resetAccount(){
  const savedCodes=JSON.stringify(usedCodes);
  localStorage.clear();
  localStorage.setItem("usedCodes",savedCodes);
  location.reload();
}

updateUI();
</script>
</body>
</html>