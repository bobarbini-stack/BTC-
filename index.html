<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>ØµØ±Ø§ÙÛŒ Ú©Ø±ÛŒÙ¾ØªÙˆ</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#020617;color:white;}
.topbar {position:fixed;top:0;left:0;width:100%;padding:40px 20px 10px 20px;background:#020617;border-bottom:1px solid #1e293b;font-size:18px;font-weight:bold;z-index:999;}
#tomanTop {color:#22c55e;font-size:20px;}

.main {display:flex;justify-content:center;align-items:center;height:100vh;}
.coin-btn {padding:14px 30px;border:none;border-radius:10px;background:#f59e0b;font-size:18px;font-weight:bold;cursor:pointer;margin:10px;}

.modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:500;}
.modal-content {width:380px;background:#020617;padding:20px;border-radius:12px;position:relative;text-align:center;}
.close-btn {position:absolute;top:8px;left:10px;cursor:pointer;font-size:18px;}

button.trade {padding:8px 16px;margin:5px;border-radius:6px;font-weight:bold;cursor:pointer;border:none;}
button.buy{background:#22c55e;color:black;}
button.sell{background:#ef4444;color:white;}

#spinnerBtn,#codeBtn,#historyBtn,#resetBtn {
position:fixed;right:20px;width:50px;height:50px;border-radius:50%;
border:none;cursor:pointer;z-index:1000;font-size:12px;color:white;font-weight:bold;
}
#spinnerBtn{top:30px;background:#f59e0b;font-size:22px;}
#codeBtn{top:100px;background:#0ea5e9;}
#historyBtn{top:170px;background:#9333ea;}
#resetBtn{top:240px;background:#ef4444;}

#wheelContainer {position:relative;width:300px;height:300px;margin:20px auto;}
#wheelCanvas {background:#020617;border-radius:50%;display:block;}

#loginModal .modal-content{width:300px;}
#usernameInput{width:90%;padding:8px;margin-top:10px;border-radius:6px;border:none;}
#loginModal button{margin-top:10px;padding:8px 16px;border:none;border-radius:8px;background:#22c55e;font-weight:bold;}
</style>
</head>
<body>

<!-- Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ -->
<div class="modal" id="loginModal" style="display:flex;">
  <div class="modal-content">
    <h2>ğŸ‘¤ ÙˆØ±ÙˆØ¯</h2>
    <input type="text" id="usernameInput" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
    <button onclick="login()">ÙˆØ±ÙˆØ¯</button>
  </div>
</div>

<div class="topbar">ğŸ’° <span id="usernameDisplay"></span> | <span id="tomanTop">0</span> ØªÙˆÙ…Ø§Ù†</div>

<div class="main">
  <button class="coin-btn" onclick="openCoin('BTC')">ğŸª™ BTC</button>
  <button class="coin-btn" onclick="openCoin('NOT')">ğŸª™ NOT</button>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ø±Ø² -->
<div class="modal" id="coinModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeCoin()">âœ–</div>
    <h2 id="coinTitle">ğŸ’± BTC</h2>
    <div class="price">Ù‚ÛŒÙ…Øª: <span id="price">0</span> ØªÙˆÙ…Ø§Ù†</div>
    <div class="wallet">Ø¯Ø§Ø±Ø§ÛŒÛŒ: <span id="balance">0</span></div>
    <input type="number" id="amount" placeholder="Ù…Ù‚Ø¯Ø§Ø±" min="0.01" step="0.01">
    <div style="display:flex;justify-content:space-between;">
      <button class="trade buy" onclick="buy()">Ø®Ø±ÛŒØ¯</button>
      <button class="trade sell" onclick="sell()">ÙØ±ÙˆØ´</button>
    </div>
  </div>
</div>

<!-- Ø¯Ú©Ù…Ù‡ Ù‡Ø§ -->
<button id="spinnerBtn">ğŸ¡</button>
<button id="codeBtn" onclick="openCodeModal()">Ú©Ø¯</button>
<button id="historyBtn" onclick="openHistory()">ğŸ“œ</button>
<button id="resetBtn" onclick="openResetModal()">ğŸ—‘ï¸</button>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ -->
<div class="modal" id="spinnerModal">
  <div class="modal-content">
    <div class="close-btn" onclick="closeSpinner()">âœ–</div>
    <h2>ğŸ¡ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</h2>
    <div id="wheelContainer">
      <canvas id="wheelCanvas" width="300" height="300"></canvas>
    </div>
    <button onclick="spinWheel()">Ú†Ø±Ø®Ø´</button>
    <p id="rewardText" style="font-size:22px;margin-top:10px;"></p>
  </div>
</div>

<script>
let toman=parseInt(localStorage.getItem("toman"))||5000;
let username=localStorage.getItem("username")||"";

let coins={
 BTC:{price:50,balance:parseFloat(localStorage.getItem("btc"))||0},
 NOT:{price:1000,balance:parseFloat(localStorage.getItem("notc"))||0}
};
let currentCoin="BTC";

// Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ø±ÙˆØ² Ú¯Ø±Ø¯ÙˆÙ†Ù‡ âœ…
let lastSpinDate = localStorage.getItem("lastSpinDate") || "";

// ÙØ±Ù…Øª Ù¾ÙˆÙ„
function formatMoney(num){return Math.floor(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}

function saveStorage(){
 localStorage.setItem("toman",toman);
 localStorage.setItem("btc",coins.BTC.balance);
 localStorage.setItem("notc",coins.NOT.balance);
}

function updateUI(){
 let c=coins[currentCoin];
 document.getElementById("price").innerText=formatMoney(c.price);
 document.getElementById("balance").innerText=c.balance.toFixed(6);
 document.getElementById("tomanTop").innerText=formatMoney(toman);
 document.getElementById("usernameDisplay").innerText=username;
 document.getElementById("coinTitle").innerText="ğŸ’± "+currentCoin;
}

// ÙˆØ±ÙˆØ¯
function login(){
 let input=document.getElementById("usernameInput").value.trim();
 if(!input) return alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
 username=input;
 localStorage.setItem("username",username);
 document.getElementById("loginModal").style.display="none";
 updateUI();
}

function openCoin(name){
 currentCoin=name;
 document.getElementById("coinModal").style.display="flex";
 updateUI();
}
function closeCoin(){document.getElementById("coinModal").style.display="none";}

// Ø®Ø±ÛŒØ¯
function buy(){
 let amount=parseFloat(document.getElementById("amount").value);
 if(!amount||amount<=0) return alert("Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª");
 let c=coins[currentCoin];
 let cost=amount*c.price;
 if(toman<cost) return alert("Ù¾ÙˆÙ„ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª");
 toman-=cost;
 c.balance+=amount;
 saveStorage();updateUI();
}

// ÙØ±ÙˆØ´
function sell(){
 let amount=parseFloat(document.getElementById("amount").value);
 if(!amount||amount<=0) return alert("Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª");
 let c=coins[currentCoin];
 if(c.balance<amount) return alert("Ø¯Ø§Ø±Ø§ÛŒÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª");
 c.balance-=amount;
 toman+=amount*c.price;
 saveStorage();updateUI();
}

// ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª
setInterval(()=>{
 Object.keys(coins).forEach(name=>{
   let change=Math.floor(Math.random()*60)-30;
   coins[name].price+=change;
   if(coins[name].price<1) coins[name].price=1;
 });
 updateUI();
},300);

// Ú¯Ø±Ø¯ÙˆÙ†Ù‡ ğŸ¡
const spinnerBtn=document.getElementById("spinnerBtn");
const spinnerModal=document.getElementById("spinnerModal");
const rewardText=document.getElementById("rewardText");

spinnerBtn.onclick=()=>{rewardText.innerText="";spinnerModal.style.display="flex";};
function closeSpinner(){spinnerModal.style.display="none";}

const canvas=document.getElementById("wheelCanvas");
const ctx=canvas.getContext("2d");
const rewards=[500,200,100,50,10,1];
const colors=["#f87171","#fbbf24","#34d399","#60a5fa","#a78bfa","#f472b6"];
const n=rewards.length;
const radius=canvas.width/2;
let currentRotation=0;
let spinning=false;

function drawWheel(rotation=0){
 ctx.clearRect(0,0,canvas.width,canvas.height);
 for(let i=0;i<n;i++){
   const start=(i/n)*2*Math.PI+rotation;
   const end=((i+1)/n)*2*Math.PI+rotation;
   const mid=(start+end)/2;
   ctx.beginPath();
   ctx.moveTo(radius,radius);
   ctx.arc(radius,radius,radius,start,end);
   ctx.closePath();
   ctx.fillStyle=colors[i];
   ctx.fill();
   ctx.save();
   ctx.translate(radius,radius);
   ctx.rotate(mid);
   ctx.fillStyle="black";
   ctx.font="bold 16px Arial";
   ctx.textAlign="center";
   ctx.textBaseline="middle";
   ctx.fillText(rewards[i]+" ØªÙˆÙ…Ø§Ù†",radius*0.6,0);
   ctx.restore();
 }
}
drawWheel();

function spinWheel(){
 const today = new Date().toDateString(); // ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² âœ…

 if(lastSpinDate === today){
   rewardText.innerText = "â›” Ø§Ù…Ø±ÙˆØ² Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø±Ø§ Ø²Ø¯Ù‡â€ŒØ§ÛŒ!";
   rewardText.style.color = "red";
   return;
 }

 if(spinning) return;
 spinning=true;

 const segmentAngle=2*Math.PI/n;
 const randomIndex=Math.floor(Math.random()*n);
 const finalRotation=5*2*Math.PI+randomIndex*segmentAngle;
 const duration=3000;
 const start=performance.now();
 const startRotation=currentRotation;

 function animate(time){
   const t=Math.min((time-start)/duration,1);
   const ease=1-Math.pow(1-t,3);
   currentRotation=startRotation+(finalRotation-startRotation)*ease;
   drawWheel(currentRotation);
   if(t<1){
     requestAnimationFrame(animate);
   }else{
     const win=rewards[randomIndex];
     toman+=win;
     rewardText.innerText="ğŸ‰ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒ: "+win+" ØªÙˆÙ…Ø§Ù†";
     rewardText.style.color="#22c55e";
     
     lastSpinDate = today; // Ø°Ø®ÛŒØ±Ù‡ Ø±ÙˆØ² Ø¢Ø®Ø± âœ…
     localStorage.setItem("lastSpinDate", today);

     saveStorage();
     updateUI();
     spinning=false;
   }
 }
 requestAnimationFrame(animate);
}

// ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±
if(username){
 document.getElementById("loginModal").style.display="none";
 updateUI();
}
</script>
</body>
  </html>
